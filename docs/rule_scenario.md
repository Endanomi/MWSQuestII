## フィルタルール

フィルタルールの操作には、ルールを追加する add と、ルールを削除する delete 、およびルールの優先順位を変更する move があります。
なお、指定する際は角括弧 [] を入力する必要はありませんが、丸括弧 () 内についての指定を行う場合に限り、丸括弧 () を入力する必要があります。
また、新しく追加したルールは一番優先順位が低くなります。つまり、前に追加したフィルタルールの番号が小さいものほど優先されます。
デフォルトのルールは、すべての入国者を許可する設定になっています。

### 人の属性と現実との対応付け

- 出発地
  - 送信元IPアドレス
- 目的地
  - 宛先IPアドレス
- 職業
  - ポート番号
- 持ち物
  - ペイロード
- 荷物量
  - パケットサイズ

### add の使い方

add [入国可否] [出発地] -> [目的地] [職業] (item:[持ち物], maxsize:[上限荷物量])
- 入国可否：以下の 3 つから選ぶ
  - pass：入国を許可する
  - drop：入国を許可せずにその場で逮捕するため、相手国に本国への入国を許可しなかったことは伝わらない
  - reject：入国を許可せずに追い返すため、相手国に本国への入国を許可しなかったことが伝わる
- 出発地
  - ログや掲示板を確認して、入国を許可したい / 禁止したい人の出発地を入力する
  - 特定の出発地に限定しない場合は any を指定する
- 目的地
  - ログや掲示板を確認して、入国する人の目的地として、許可したい / 禁止したい場所の名前を入力する
  - 特定の目的地に限定しない場合は any を指定する
- 職業
  - ログや掲示板を確認して、入国を許可したい / 禁止したい人の職業を入力する
  - 特定の職業に限定しない場合は any を指定する
- 持ち物
  - ログや掲示板を確認して、入国を許可したい / 禁止したい人の持ち物を入力する
  - 特定の持ち物に限定しない場合は item: ごと省略する
- 上限荷物量
  - ログや掲示板を確認して、設定した荷物の上限量を超えた人を drop または reject できる
  - 上限荷物量を定めない場合は maxsize: ごと省略する
- 使用例
  - add pass B国 -> 市場 商人 (item:小麦)
    - 出発地が**B国**、目的地が**市場**，職業が**商人**で持ち物が**小麦**の人の入国を許可する
  - add drop any -> 城 any
    - 出発地および職業を問わず、目的地が**城**の人を逮捕する
  - add reject any -> any any (maxsize:100)
    - 出発地、目的地、および職業を問わず、上限荷物量の**100**を超えた人を制限する
    - 荷物量が**101**以上の場合は入国を許可せず追い返す

### delete の使い方

delete [フィルタルールの番号]
- フィルタルールの番号
  - 削除したいフィルタルールの番号を入力する
  - 番号は、フィルタルール一覧の表の最左列にある数字に対応する
- 使用例
  - delete 5
    - 5 番のフィルタルールを削除する

### move の使い方

move [フィルタルールの番号] [フィルタルールの番号]
- フィルタルールの番号
  - 優先順位を入れ替えたいフィルタルールの番号をそれぞれ入力する（順不同）
- 使用例
  - move 1 3
    - 1番と3番のフィルタルールを入れ替える

## シナリオ

このゲームの問題は、実際のサイバー攻撃に基づいて作成されています。
住民の意見に合わせた正しいフィルタルールと、ゲーム内の要素が現実世界で何に対応するのかを詳しく解説します。

### 住民の意見

#### 住民 A

A国から大量の人々が押し寄せているようだ。全員空の木箱しか持たずに入国しようとしていて怪しい。また、その人々の影響で国内の店などが人で溢れかえってしまい、まともに運営できなくなってしまっている。
- 実際のサイバー攻撃との対応付け
  - DoS攻撃 (大量の通信)
- 正しいフィルタルール
  - add reject A国 → any any (item: 木箱)

#### 解説

DoS攻撃（Denial of Service 攻撃 / サービス拒否攻撃）は、攻撃対象のサービスを利用不能にする（可用性を侵害する）ことを目的とした攻撃です。
今回の場合では、サービスの処理能力を超える大量のデータを送信するDoS攻撃を再現しています。
実際にログではA国から木箱（意味のないデータ）を持った旅人が入国（通信）しようとしている様子が観察できます。
このように大量の通信が発生しているかという条件をもとに、DoS攻撃かを判断することが重要です。

#### 住民 B

D国から商人が大量の荷物を持って入国しているようだ。
しかし、あまりにも荷物が大きすぎるがゆえに、道を塞いでしまい他の人々の通行を妨げてしまっている。
- 現実との対応付け
  - DoS攻撃 (大きいパケットサイズ)
- 正しいフィルタルール
  - add reject D国 → any 商人 (maxsize: 1000)


#### 解説
DoS攻撃の中には、サイズの大きいペイロードを用いて攻撃対象のサービスを利用不能にする手法が存在しています。
今回はその手法の攻撃を再現しており、大量の荷物がサイズの大きいペイロードを表現しています。
通常のログと比較して、荷物量が多いログを発見できるかが鍵となります。
通常の入国を遮断してしまわないためにも、荷物量が多い場合に絞ってルールを設定する必要があります。

#### 住民 C

スパイが入国して、国の重要な情報を取集しているらしい。
スパイの特徴として、出発地を偽装し、身元を隠している。
- 現実との対応付け
  - IPスプーフィング
- 正しいフィルタルール
  - add reject 神殿 → any any

#### 解説
IPスプーフィングは、パケットの送信元（出発地）IPアドレスを書き換えて別の場所から送られたように見せる攻撃です。
これにより攻撃者を追跡しにくくなります。
ゲーム内では、送信元が“領地内の場所”になっている点が不自然であること（本来その出発地からは来ないはず）を利用して、不正なアクセスを発見しました。
現実でも「ありえない出発地」が表示されたら注意が必要です。
具体例として、攻撃者が実際の送信元ではなく、アクセス先（ターゲット）や社内の別のIPアドレスを送信元に見せかけていることがあります。

#### 住民 D

E国から様々な職業の人が市街地に押しかけている。
色々な職業を送り込むことで、国の内部情勢を調査しているらしい。
直ぐに取り締まらないと、内部情報がE国にばれてしまう。
- 現実との対応付け
  - ポートスキャン
- 正しいフィルタルール
  - add drop E国 → 市街地 any

#### 解説
ポートスキャンは、相手のどのポートが開いているかを順番に確かめる行為です。
コンピュータのポートは「そのコンピュータで動く仕事（サービス）」ごとの窓口です。
今回の場合では、職業 = ポートとして表現しました。たとえば、「郵便局員」はファイル転送（FTP）の役割をしています。
どのポートが開いているかが分かれば、そこからどんなサービスが動いているか推測でき、既知の弱点があれば侵入に使われる可能性があります。
そのため、IPSが不審な通信を検知し、それをdropする必要があります。

#### 住民 E

最近周辺の国々で、入国した途端に爆発して周りに被害を与える危険な物品が流通しているという情報が入った。
どうやら芸術品の「木馬」という名前で持ち込まれてくるらしい。
「木馬」を持っている人は、再び危険な物を持ってくる可能性が高いため、取り締まるべきだ。
- 現実との対応付け
  - マルウェア送り込み（トロイの木馬）
- 正しいフィルタルール
  - add drop any → any any (item: 木馬)

#### 解説
マルウェアとは、コンピュータの中に保存されているデータを勝手に書き換えたり、外部に漏洩させたりするような悪意のあるソフトウェアの総称です。
IPS には、マルウェアがコンピュータに侵入しないよう、既にマルウェアとして知られているソフトウェアの情報の一部を所持し、その情報に合致する通信を破棄する機能が備わっています。
今回は持ち物である「木馬」をマルウェアに例えました。なお、実際に「トロイの木馬」と呼ばれるマルウェアが存在します。
これは、無害なプログラムを装ってコンピュータ内に侵入し、情報を盗み取るなどの悪事を働くものです。
